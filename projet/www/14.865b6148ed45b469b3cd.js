(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"1eIT":function(t,e,i){"use strict";i.r(e),i.d(e,"VenteModule",function(){return z});var a=i("SVse"),n=i("iInd"),s=i("s7LF"),r=i("M9IT"),l=i("PSD3"),o=i.n(l),c=i("0IaG"),h=i("8Y7J"),b=i("SCoL"),d=i("bAEo"),m=i("LuIz"),u=i("kmnG"),p=i("d3UM"),g=i("FKr1"),v=i("qFsG"),f=i("uM5D");function _(t,e){if(1&t&&(h.Tb(0,"a",46),h.Tb(1,"span"),h.Cc(2),h.Sb(),h.Sb()),2&t){const t=h.ec().$implicit;h.Cb(2),h.Ec("",t.nom," ")}}function x(t,e){if(1&t){const t=h.Ub();h.Tb(0,"a",47),h.ac("click",function(){h.sc(t);const e=h.ec().$implicit;return h.ec().filtre_cat(e.nom,e.id)}),h.Tb(1,"span"),h.Cc(2),h.Sb(),h.Sb()}if(2&t){const t=h.ec().$implicit;h.Cb(2),h.Ec("",t.nom," ")}}function T(t,e){if(1&t&&(h.Tb(0,"li",43),h.Ac(1,_,3,1,"a",44),h.Ac(2,x,3,1,"a",45),h.Sb()),2&t){const t=e.$implicit,i=h.ec();h.Cb(1),h.kc("ngIf",i.choix==t.nom),h.Cb(1),h.kc("ngIf",!(i.choix==t.nom))}}function C(t,e){if(1&t){const t=h.Ub();h.Rb(0),h.Tb(1,"div",48),h.Tb(2,"div",49),h.ac("click",function(){h.sc(t);const i=e.$implicit;return h.ec().ajouter_table(i)}),h.Tb(3,"p",50),h.Cc(4),h.Sb(),h.Ob(5,"img",51),h.Tb(6,"h3",52),h.Cc(7),h.Sb(),h.Sb(),h.Sb(),h.Qb()}if(2&t){const t=e.$implicit;h.Cb(4),h.Dc(t.nom),h.Cb(1),h.mc("src","data:image/png;base64,",t.image,"",h.tc),h.Cb(2),h.Ec("",t.prix_vente," DT")}}function S(t,e){if(1&t&&(h.Tb(0,"mat-option",53),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.kc("value",t.id),h.Cb(1),h.Ec(" ",t.nom,"")}}function w(t,e){if(1&t){const t=h.Ub();h.Tb(0,"tr"),h.Tb(1,"td"),h.Tb(2,"input",54),h.ac("keyup",function(i){h.sc(t);const a=e.$implicit;return h.ec().calcule(i,a)}),h.Sb(),h.Sb(),h.Tb(3,"td"),h.Cc(4),h.Sb(),h.Tb(5,"td"),h.Cc(6),h.Sb(),h.Tb(7,"td"),h.Cc(8),h.Sb(),h.Tb(9,"td"),h.Tb(10,"i",55),h.ac("click",function(){h.sc(t);const i=e.index,a=e.$implicit;return h.ec().supprimer(i,a.prix)}),h.Sb(),h.Sb(),h.Sb()}if(2&t){const t=e.$implicit;h.Cb(2),h.lc("value",t.qte_v),h.lc("placeholder",t.qte),h.kc("matKeyboard","de-CH"),h.Cb(2),h.Ec(" ",t.nom," "),h.Cb(2),h.Ec(" ",t.prix_vente," "),h.Cb(2),h.Ec(" ",t.prix," ")}}function y(t,e){if(1&t){const t=h.Ub();h.Tb(0,"li",56),h.Tb(1,"a",29),h.ac("click",function(){return h.sc(t),h.ec().valide_achat()}),h.Ob(2,"img",57),h.Sb(),h.Sb()}}function N(t,e){if(1&t){const t=h.Ub();h.Tb(0,"li",58),h.ac("click",function(){return h.sc(t),h.ec().reglement()}),h.Tb(1,"a",32),h.Ob(2,"img",59),h.Sb(),h.Sb()}}function k(t,e){if(1&t){const t=h.Ub();h.Tb(0,"li",60),h.Tb(1,"a",29),h.ac("click",function(){return h.sc(t),h.ec().generate_ticket()}),h.Ob(2,"img",61),h.Sb(),h.Sb()}}function F(t,e){if(1&t){const t=h.Ub();h.Tb(0,"li",62),h.Tb(1,"a",29),h.ac("click",function(){return h.sc(t),h.ec().facture()}),h.Ob(2,"img",63),h.Sb(),h.Sb()}}const M=function(){return[8,12,24,48,100]};function D(t,e){if(1&t){const t=h.Ub();h.Tb(0,"tbody"),h.Tb(1,"tr"),h.Tb(2,"td"),h.Tb(3,"select",13),h.ac("change",function(i){h.sc(t);const a=e.index;return h.ec().savemode(a,i)}),h.Tb(4,"option",14),h.Cc(5,"esp\xe8ces"),h.Sb(),h.Tb(6,"option",15),h.Cc(7,"ticket"),h.Sb(),h.Tb(8,"option",16),h.Cc(9,"Ch\xe8que"),h.Sb(),h.Sb(),h.Sb(),h.Tb(10,"td"),h.Tb(11,"input",17),h.ac("keyup",function(i){h.sc(t);const a=e.index;return h.ec().savenmontant(a,i)}),h.Sb(),h.Sb(),h.Tb(12,"td"),h.Tb(13,"input",18),h.ac("keyup",function(i){h.sc(t);const a=e.index;return h.ec().saveinfo(a,i)}),h.Sb(),h.Sb(),h.Tb(14,"td"),h.Tb(15,"i",19),h.ac("click",function(){h.sc(t);const i=e.index;return h.ec().supp(i)}),h.Sb(),h.Sb(),h.Sb(),h.Sb()}if(2&t){const t=e.index,i=h.ec();h.Cb(11),h.lc("value",i.table[t].montant),h.Cb(2),h.lc("value",i.table[t].info)}}const E=i("5JmO"),P=i("TruH");E.vfs=P.pdfMake.vfs;let j=(()=>{class t{constructor(t,e,i,a,n,l,o){this.plt=t,this.dialog=e,this.service=i,this.route=a,this.router=n,this.datePipe=l,this.printer=o,this.data=[],this.data2=[],this.clt="Passager",this.nticket="00001",this.page=0,this.size=15,this.total=0,this.benifice=0,this.valide=!1,this.payee=!1,this.btn_valide=!1,this.table_reglement=[],this.etat_paiement=!1,this.objxml={},this.paginator=r.a,this.mode_type=!0,this.form=new s.f({id:new s.d(""),nom:new s.d(""),code:new s.d(""),categorie:new s.d(""),unite:new s.d("")}),this.test_modifier=!1,this.choix=" ",this.table=[],this.liste_tva=[],this.obj_tva={},this.test_balance=!1,this.convertBlobFichier=(t,e)=>{var i=t;return i.lastModifiedDate=new Date,i.name=e,t},this.user=JSON.parse(localStorage.getItem("User")+""),this.session=JSON.parse(localStorage.getItem("session")+""),this.produit=new s.f({nom:new s.d(""),categorie:new s.d(""),image:new s.d(""),unite:new s.d(""),prix_achat:new s.d(""),prix_vente:new s.d("")}),this.get_categories(),this.get_produits(),this.choix=""}get_produits(){this.service.Produits().subscribe(t=>{this.data2=t;for(let e=0;e<this.data2.length;e++)this.data2[e].prix_vente=Number(this.data2[e].prix_vente*(1+this.data2[e].tva/100)).toFixed(3);this.getData({pageIndex:this.page,pageSize:this.size})})}set_categorie(t){this.choix=t}ngOnInit(){}calcule_tva(){this.liste_tva=[];for(let t=0;t<this.table.length;t++){this.obj_tva={},this.obj_tva.tva=this.table[t].tva,this.obj_tva.val=Number(Number(this.table[t].prix_vente-Number(this.table[t].prix_vente*(1-this.table[t].tva/100)))*this.table[t].qte_v).toFixed(3),this.obj_tva.montant=Number(this.table[t].prix).toFixed(3);let e=!1;if(0==this.liste_tva.length)this.liste_tva.push(this.obj_tva);else{for(let t=0;t<this.liste_tva.length;t++)this.obj_tva.tva==this.liste_tva[t].tva&&(this.liste_tva[t].val=Number(Number(this.liste_tva[t].val)+Number(this.obj_tva.val)).toFixed(3),this.liste_tva[t].montant=Number(Number(this.liste_tva[t].montant)+Number(this.obj_tva.montant)).toFixed(3),e=!0);0==e&&this.liste_tva.push(this.obj_tva)}}}ajouter_article_code_a_barre(t){var e;if("Enter"==t.key){let t=null===(e=this.form.get("code"))||void 0===e?void 0:e.value;this.code_barre_produit=t[0]+t[1]+t[2]+t[3]+t[4]+t[5]+t[6],this.code_barre_qte=t[7]+t[8]+t[9]+t[10]+t[11],this.form.controls.code.setValue(""),this.service.filtre_produit("id","","nom","","Code_Barre",this.code_barre_produit,"unite","","categorie","").subscribe(e=>{e.length>0?(2==t[0]&&(e[0].qte_v=Number(Number(this.code_barre_qte)/1e3).toFixed(3),e[0].prix_vente=Number(e[0].prix_vente*(1+e[0].tva/100)).toFixed(3),this.test_balance=!0),this.ajouter_table(e[0])):o.a.fire({icon:"error",title:"",text:"Produit Inconnu "})})}}ajouter_table(t){if(this.btn_valide=!0,this.valide=!1,this.payee&&(this.table=[],this.payee=!1,this.table_reglement=[],this.total=0),this.payee=!1,0==t.qte)o.a.fire({icon:"error",title:"",text:"Quantit\xe9 non disponible en stock "});else{let e=-1,i=0,a=0;for(let n=0;n<this.table.length;n++)t.id==this.table[n].id&&(e=n);-1==e?0==this.test_balance?(t.qte_v=Number(1),t.prix=Number(Number(t.prix_vente)*Number(t.qte_v)).toFixed(3),i=t.prix,a=t.prix_achat,this.table.push(t)):(t.prix=Number(Number(t.prix_vente)*Number(t.qte_v)).toFixed(3),i=t.prix,a=t.prix_achat,this.table.push(t)):0==this.test_balance?t.qte<Number(this.table[e].qte_v)+1?o.a.fire({icon:"error",title:"",text:"Quantit\xe9 non disponible en stock "}):(this.table[e].qte_v=Number(this.table[e].qte_v)+1,this.table[e].prix=Number(Number(this.table[e].prix_vente)*Number(this.table[e].qte_v)).toFixed(3),i=this.table[e].prix):(this.table[e].qte_v=Number(this.table[e].qte_v)+t.qte_v,this.table[e].prix=Number(Number(this.table[e].prix_vente)*Number(this.table[e].qte_v)).toFixed(3),i=this.table[e].prix)}this.test_balance=!1,this.calcule_total(),this.calcule_tva()}getData(t){let e=0,i=t.pageIndex*t.pageSize,a=i+t.pageSize;this.data=this.data2.filter(()=>(e++,e>i&&e<=a))}filtre(){var t,e;null==this.categorie&&(this.categorie=""),this.service.filtre_produit("id",null===(t=this.form.get("id"))||void 0===t?void 0:t.value,"nom",null===(e=this.form.get("nom"))||void 0===e?void 0:e.value,"Code_Barre","","unite","","categorie",this.categorie).subscribe(t=>{this.data2=t,this.getData({pageIndex:this.page,pageSize:this.size})})}filtre_cat(t,e){this.choix=t,this.categorie=e,this.filtre()}get_categories(){this.service.categories().subscribe(t=>{this.liste_categorie=t})}choix_categorie(t){this.categorie=t.value,this.choix="",this.filtre()}mode(){this.mode_type=!this.mode_type,this.mode_type&&this.router.navigate(["/vente"]),0==this.mode_type&&this.router.navigate(["/menu/vente"])}supprimer(t,e){o.a.fire({title:"\xcates-vous s\xfbr?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui, supprimez le",cancelButtonText:"Non, garde le"}).then(i=>{i.value?(this.table.splice(t,1),this.total=Number(this.total)-Number(e),0==this.total&&(this.btn_valide=!1)):i.dismiss===o.a.DismissReason.cancel&&o.a.fire("Annul\xe9","","error")})}facture(){o.a.fire({title:"Facture",html:'Client <input id="swal-input2"  type="text" value="" class="swal2-input" placeholder="Passager"   [matKeyboard]="de-CH" > <br>ID fiscale <input id="swal-input3"  type="text" value="" class="swal2-input" placeholder="Passager"   [matKeyboard]="de-CH" >',focusConfirm:!1,preConfirm:()=>[document.getElementById("swal-input2").value,document.getElementById("swal-input3").value],allowOutsideClick:()=>!o.a.isLoading()}).then(t=>{this.a=t.value,t.isConfirmed&&this.facturation(this.id_vente,this.a[0],this.a[1]),o.a.fire("Facture"," ","success")})}calcule_total(){let t=0,e=0;for(let i=0;i<this.table.length;i++)t+=Number(this.table[i].prix),e+=Number(this.table[i].prix_achat);this.total=Number(t).toFixed(3),this.benifice=e}generatePDF(t,e,i){var a=[],n=[],s=[],r=new Array;r=new Array,this.e={text:"Id",alignment:"center"},r.push(this.e),this.e={text:"Nom Produit"},r.push(this.e),this.e={text:"Qte",alignment:"center"},r.push(this.e),this.e={text:"Unite",alignment:"center"},r.push(this.e),this.e={text:"Prix U HT",alignment:"center"},r.push(this.e),this.e={text:"%TVA",alignment:"center"},r.push(this.e),this.e={text:"Prix U ttc",alignment:"center"},r.push(this.e),this.e={text:"Total HT",alignment:"center"},r.push(this.e),this.e={text:"Total TTC",alignment:"center"},r.push(this.e),a.push(r);for(let c=0;c<this.table.length;c++){r=new Array,this.e={text:this.table[c].id,alignment:"center"},r.push(this.e),this.e={text:this.table[c].nom},r.push(this.e),this.e={text:this.table[c].qte_v,alignment:"center"},r.push(this.e),this.e={text:this.table[c].unite.nom,alignment:"center"},r.push(this.e),this.e={text:this.table[c].prix_vente,alignment:"right"},r.push(this.e),this.e={text:this.table[c].tva,alignment:"center"},r.push(this.e);let t=Number(Number(this.table[c].prix_vente)/Number(100+this.table[c].tva)*100).toFixed(3);this.e={text:t,alignment:"right"},r.push(this.e);let e=Number(this.table[c].prix_vente*this.table[c].qte_v).toFixed(3);this.e={text:e,alignment:"right"},r.push(this.e);let i=Number(Number(t)*Number(this.table[c].qte_v)).toFixed(3);this.e={text:i,alignment:"right"},r.push(this.e),a.push(r)}r=new Array,this.e={text:"%Tva",alignment:"center"},r.push(this.e),this.e={text:"Assiette",alignment:"center"},r.push(this.e),this.e={text:"Valeur",alignment:"center"},r.push(this.e),n.push(r);for(let c=0;c<this.liste_tva.length;c++)r=new Array,this.e={text:this.liste_tva[c].tva,alignment:"center"},r.push(this.e),this.e={text:Number(this.liste_tva[c].montant).toFixed(3),alignment:"right"},r.push(this.e),this.e={text:Number(this.liste_tva[c].val).toFixed(3),alignment:"right"},r.push(this.e),n.push(r);(r=new Array).push("Total HT :"),this.e={text:Number(this.total).toFixed(3),alignment:"right"},r.push(this.e),r.push(" DT"),s.push(r),(r=new Array).push("Timbre :"),this.e={text:"0.600",alignment:"right"},r.push(this.e),r.push(" DT"),s.push(r),(r=new Array).push("Total TTC :"),this.e={text:Number(this.total).toFixed(3),alignment:"right"},r.push(this.e),r.push(" DT"),s.push(r),r=new Array;var l="";for(let c=0;c<this.table_reglement.length;c++)l=l+this.table_reglement[c].mode+" : "+this.table_reglement[c].montant+"\n";var o={defaultStyle:{},pageMargins:[40,100,40,180],info:{title:"Vente"},footer:function(t,e){return{margin:35,columns:[{fontSize:9,text:[{text:t.toString()+"/"+e}],relativePosition:{x:250,y:130}}]}},header:[{text:"Facture",fontSize:18,color:"black",bold:!0,relativePosition:{x:250,y:20}},{text:"Client : "+t,fontSize:10,color:"black",relativePosition:{x:400,y:80}},{text:"Identifiant : "+i,fontSize:10,color:"black",relativePosition:{x:400,y:100}},,{text:"N\xb0 Facture  : "+e,fontSize:10,color:"black",relativePosition:{x:400,y:40}},{text:""+this.datePipe.transform(new Date,"dd/MM/yyyy"),fontSize:6,color:"black",bold:!0,relativePosition:{x:520,y:10}},{text:"N\xb0 Ticket : "+this.id_vente,fontSize:10,color:"black",relativePosition:{x:400,y:60}}],content:[{table:{widths:[30,100,30,30,45,27,50,50,50],body:a},fontSize:10,margin:[10,40,30,20]},{text:"Assiette TVA",fontSize:12,color:"black"},{table:{widths:[40,70,70],body:n},fontSize:10,margin:[10,20,10,50]},,{table:{widths:[50,55,15],body:s},fontSize:10,margin:[383,0,0,0],layout:"noBorders"},{text:"R\xe9glements",fontSize:12,color:"black"},{text:l,fontSize:8,color:"black"}]};E.createPdf(o).open({defaultFileName:"achat"+new Date+".pdf"})}generate_ticket(){let t="";for(let i=0;i<this.table.length;i++)t=t+"<tr><td width='10%'>"+this.table[i].qte_v+"</td> <td  width='50%'>"+this.table[i].nom+"</td> <td  width='20%'>"+Number(this.table[i].prix_vente).toFixed(3)+"</td> <td  width='20%'>"+Number(this.table[i].prix).toFixed(3)+"</td></tr>";let e=" <img style='width: 30%; margin-left: 33%; '  src='./../../assets/images/affecter.jpg'><br> <h1 style='text-align: center; '>  Infonet </h1> <p style='text-align: center; '>  Date :"+this.datePipe.transform(this.data_vente.date,"dd/MM/yyyy HH:mm:ss")+"   </p> <h3 style='text-align: center; '>  Ticket N\xb0  "+this.id_ticket+"  </h3> <table >      <tr>    <td>Agent :</td>   <td> "+this.user.nom+" </td>   <td> </td>   <td>Caisse :</td>   <td> "+this.session[0].caisse.nom+"</td>  </tr></table><table >      <tr>    <th width='10%'>Qte</th>   <th width='50%' style=' text-align: left;'>D\xe9signation</th>   <th width='20%'>Prix_U</th>   <th width='20%'>Total</th>  </tr>"+t+"</table><h4 style='text-align: right;' >  Montant Total : "+Number(this.total).toFixed(3)+" DT </h4 > <p   >  Re\xe7u : "+Number(this.recu).toFixed(3)+" Rendu : "+Number(this.rendu).toFixed(3)+" </p > <p style='text-align: center; '>  Merci pour votre visite </p>";this.printer.print(e,{name:"MyDocument"}),this.plt.isBrowser&&(this.popupWin=window.open("","test","top=0,left=0,height=auto,width=auto,toolbar=0,scrollbars=0,status=0"),this.popupWin.document.open(),this.popupWin.document.write(`\n       <html>\n         <head>  \n           <script>\n           function fn()\n           {           \n             window.print();window.close();\n             }\n           <\/script>\n           <style  >\n           @media print{ .doNotPrint{display:none !important;} } \n           </style>\n            \n         </head>\n          <body onload="fn()">${e} </body>\n       </html>`),this.popupWin.document.close())}calcule(t,e){Number(t.target.value)>e.qte?o.a.fire({icon:"error",title:"",text:"Quantit\xe9 non disponible en stock "}):(e.prix=Number(e.prix_vente)*Number(t.target.value),e.qte_v=Number(t.target.value),this.calcule_total())}valide_achat(){this.valide=!0}reglement(){this.dialog.open(I,{width:"80%",height:"70%",data:{total:this.total,table:this.table_reglement,recu:this.recu,rendu:this.rendu}}).afterClosed().subscribe(t=>{let e=0;for(let i=0;i<this.table_reglement.length;i++)e+=Number(this.table_reglement[i].montant);this.recu=Number(e).toFixed(3),this.rendu=Number(e-Number(this.total)).toFixed(3),(Number(e)>Number(this.total)||Number(e)==Number(this.total))&&(this.payee=!0,this.test_modifier?(this.conserver_data_update(),this.test_modifier=!1,this.valide=!1):(this.conserver_data(),this.valide=!1))})}conserver_data_update(){this.formData=new FormData;var t=document.implementation.createDocument("Vente","",null),e=t.createElement("Vente"),i=t.createElement("Total");i.innerHTML=Number(this.total).toFixed(3);var a=t.createElement("Utilisateur"),n=t.createElement("Produits"),s=t.createElement("Reglements"),r=t.createElement("Tvas");for(let o=0;o<this.liste_tva.length;o++){var l=t.createElement("TVA");l.innerHTML=this.liste_tva[o].tva;var c=t.createElement("Taxe");c.innerHTML=this.liste_tva[o].tva;var h=t.createElement("Valeur");h.innerHTML=this.liste_tva[o].val;var b=t.createElement("Montant");b.innerHTML=this.liste_tva[o].montant,l.appendChild(c),l.appendChild(h),l.appendChild(b),r.appendChild(l)}for(let o=0;o<this.table.length;o++){var d=t.createElement("Produit"),m=t.createElement("Id");m.innerHTML=this.table[o].id;var u=t.createElement("Nom");u.innerHTML=this.table[o].nom;var p=t.createElement("code");p.innerHTML=this.table[o].code_Barre;var g=t.createElement("prix_u");g.innerHTML=this.table[o].prix_vente;var v=t.createElement("total");v.innerHTML=this.table[o].prix;var f=t.createElement("Qte");f.innerHTML=this.table[o].qte_v;var _=t.createElement("unite");_.innerHTML=this.table[o].unite.id,d.appendChild(m),d.appendChild(u),d.appendChild(p),d.appendChild(g),d.appendChild(v),d.appendChild(f),d.appendChild(_),n.appendChild(d)}for(let o=0;o<this.table_reglement.length;o++){var x=t.createElement("Reglement"),T=t.createElement("Type");T.innerHTML=this.table_reglement[o].mode;var C=t.createElement("Montant");C.innerHTML=this.table_reglement[o].montant;var S=t.createElement("info");S.innerHTML=this.table_reglement[o].info,x.appendChild(T),x.appendChild(C),x.appendChild(S),s.appendChild(x)}e.appendChild(a),e.appendChild(r),e.appendChild(i),e.appendChild(s),e.appendChild(n),t.appendChild(e),fetch("assets/vente.xml").then(t=>t.text()).then(e=>{let i=(new XMLSerializer).serializeToString(t.documentElement);var a=new Blob([i],{type:"application/xml"}),n=this.convertBlobFichier(a,"assets/achat.xml");this.formData.append("Detail",n),this.formData.append("Utilisateur",this.user.id),this.formData.append("Type","ticket"),this.formData.append("Client",this.clt),this.formData.append("Total",this.total),this.formData.append("Caisse",this.session[0].id),this.service.modifier_vente(this.formData).subscribe(t=>{this.id_ticket=t.id,this.id_vente=t.id,this.data_vente=t;let e=new FormData,i=Number(Number(this.total)-Number(this.benifice));e.append("Id",this.session[0].id),e.append("Solde",Number(this.total)-Number(this.total_ticket_modifier)+""),e.append("Benefice",i+""),this.service.Ajouter_solde_Session_Caisses(e).subscribe(t=>{}),o.a.fire({icon:"success",confirmButtonColor:"green",cancelButtonColor:"#3085d6",showCancelButton:!0,showDenyButton:!0,denyButtonColor:"#3085d6",confirmButtonText:"Ticket",denyButtonText:"Facture",cancelButtonText:"Quitter"}).then(t=>{t.isConfirmed?this.generate_ticket():t.isDenied&&this.facture()})})})}conserver_data(){this.formData=new FormData;var t=document.implementation.createDocument("Vente","",null),e=t.createElement("Vente"),i=t.createElement("Total");i.innerHTML=Number(this.total).toFixed(3);var a=t.createElement("Utilisateur"),n=t.createElement("Produits"),s=t.createElement("Reglements"),r=t.createElement("Tvas");for(let o=0;o<this.liste_tva.length;o++){var l=t.createElement("TVA");l.innerHTML=this.liste_tva[o].tva;var c=t.createElement("Taxe");c.innerHTML=this.liste_tva[o].tva;var h=t.createElement("Valeur");h.innerHTML=this.liste_tva[o].val;var b=t.createElement("Montant");b.innerHTML=this.liste_tva[o].montant,l.appendChild(c),l.appendChild(h),l.appendChild(b),r.appendChild(l)}for(let o=0;o<this.table.length;o++){var d=t.createElement("Produit"),m=t.createElement("Id");m.innerHTML=this.table[o].id;var u=t.createElement("Nom");u.innerHTML=this.table[o].nom;var p=t.createElement("code");p.innerHTML=this.table[o].code_Barre;var g=t.createElement("prix_u");g.innerHTML=this.table[o].prix_vente;var v=t.createElement("total");v.innerHTML=this.table[o].prix;var f=t.createElement("Qte");f.innerHTML=this.table[o].qte_v;var _=t.createElement("unite");_.innerHTML=this.table[o].unite.id,d.appendChild(m),d.appendChild(u),d.appendChild(p),d.appendChild(g),d.appendChild(v),d.appendChild(f),d.appendChild(_),n.appendChild(d)}for(let o=0;o<this.table_reglement.length;o++){var x=t.createElement("Reglement"),T=t.createElement("Type");T.innerHTML=this.table_reglement[o].mode;var C=t.createElement("Montant");C.innerHTML=this.table_reglement[o].montant;var S=t.createElement("info");S.innerHTML=this.table_reglement[o].info,x.appendChild(T),x.appendChild(C),x.appendChild(S),s.appendChild(x)}e.appendChild(a),e.appendChild(r),e.appendChild(i),e.appendChild(s),e.appendChild(n),t.appendChild(e),fetch("assets/vente.xml").then(t=>t.text()).then(e=>{let i=(new XMLSerializer).serializeToString(t.documentElement);var a=new Blob([i],{type:"application/xml"}),n=this.convertBlobFichier(a,"assets/achat.xml");this.formData.append("Detail",n),this.formData.append("Utilisateur",this.user.id),this.formData.append("Type","ticket"),this.formData.append("Client",this.clt),this.formData.append("Total",this.total),this.formData.append("Caisse",this.session[0].id),this.service.ajouter_vente(this.formData).subscribe(t=>{this.id_vente=t.id,this.data_vente=t,this.id_ticket=t.id,this.service.valider_vente(this.id_vente).subscribe(t=>{});let e=new FormData,i=Number(Number(this.total)-Number(this.benifice));e.append("Id",this.session[0].id),e.append("Solde",this.total),e.append("Benefice",i+""),this.service.Ajouter_solde_Session_Caisses(e).subscribe(t=>{}),o.a.fire({icon:"success",confirmButtonColor:"green",cancelButtonColor:"#3085d6",showCancelButton:!0,showDenyButton:!0,denyButtonColor:"#3085d6",confirmButtonText:"Ticket",denyButtonText:"Facture",cancelButtonText:"Quitter"}).then(t=>{t.isConfirmed?this.generate_ticket():t.isDenied&&this.facture()})})})}facturation(t,e,i){let a=new FormData;a.append("Id",t),a.append("Client",e),a.append("Id_Fiscale",i),this.service.facturation(a).subscribe(t=>{this.generatePDF(e,t.id,t.id_Fiscale)})}modifier_ticket(){this.payee=!1,this.payee=!1,this.valide=!1,this.test_modifier=!0,o.a.fire({title:"Ticket",html:'<table><tr><td>N\xb0 ticket : </td><td><input id="swal-input1" value="" class="swal2-input"   ></td></tr> <tr><td>Code Admin : </td><td><input  type="password" id="swal-input2" value="" class="swal2-input"    ></td></tr> </table>',focusConfirm:!1,preConfirm:()=>[document.getElementById("swal-input1").value,document.getElementById("swal-input2").value],allowOutsideClick:()=>!o.a.isLoading()}).then(t=>{this.a=t.value,"0000"==this.a[1]&&(this.table=[],this.btn_valide=!0,this.id_ticket_modifier=this.a[0],t.isConfirmed&&(this.service.Detail_vente(this.a[0]).subscribe(t=>{const e=new FileReader;e.onloadend=()=>{let t;if(this.Detail=e.result,(0,i("CDzl").parseString)(atob(this.Detail.substr(28)),function(e,i){t=i.Vente}),this.xmldata=t,this.total=0,null!=this.xmldata.Produits[0].Produit)for(let e=0;e<this.xmldata.Produits[0].Produit.length;e++)this.service.produit(this.xmldata.Produits[0].Produit[e].Id.toString()).subscribe(t=>{this.objxml=t,this.objxml.qte_v=this.xmldata.Produits[0].Produit[e].Qte.toString(),this.objxml.prix_vente=this.xmldata.Produits[0].Produit[e].prix_u.toString(),this.objxml.prix=Number(Number(this.objxml.prix_vente)*Number(this.objxml.qte_v)).toFixed(3),this.service.unite(this.xmldata.Produits[0].Produit[e].unite.toString()).subscribe(t=>{this.objxml.unite=t}),this.table.push(this.objxml),this.total=Number(Number(this.total)+Number(this.objxml.prix)).toFixed(3)})},e.readAsDataURL(t)}),this.service.vente(this.a[0]).subscribe(t=>{this.total_ticket_modifier=t.total})))})}open_cash_drawer(){this.w=window.open("windowUrl","windowName","left=0,top=0,width=0,height=0"),this.w.print(),this.w.close()}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(b.a),h.Nb(c.b),h.Nb(d.a),h.Nb(n.a),h.Nb(n.b),h.Nb(a.e),h.Nb(m.a))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-vente"]],viewQuery:function(t,e){if(1&t&&h.Gc(r.a,!0),2&t){let t;h.oc(t=h.bc())&&(e.paginator=t.first)}},decls:73,vars:21,consts:[[1,"row"],[1,"col-md-7"],[1,"col-md-12","main-card","mb-3","card",2,"margin-top","2%"],[1,"card-body"],[1,"body-tabs","body-tabs-layout","tabs-animated","body-tabs-animated","nav"],["class","nav-item",4,"ngFor","ngForOf"],["fxFill","","fxLayout","column","fxLayoutAlign","space-between","fxLayout","row wrap"],[4,"ngFor","ngForOf"],[3,"length","pageSize","pageIndex","pageSizeOptions","page"],[1,"col-md-4","mb-12","card",2,"margin-top","1%"],[3,"formGroup"],[2,"width","25%"],["formControlName","unite","aria-placeholder","kg",3,"selectionChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"custom-width",2,"width","30%"],["matInput","","placeholder","Nom","formControlName","nom","id","id",3,"matKeyboard","keyup"],[1,"custom-width",2,"width","30%","margin-left","4%"],["matInput","","placeholder","216548","formControlName","code","id","id",3,"ngModel","matKeyboard","ngModelChange","keypress"],[1,"col-md-12","mb-12","card"],[2,"color","red","text-align","right"],[1,"table",2,"margin-top","5%"],[1,"row2"],[1,"cell1","table-wrapper-scroll-y","my-custom-scrollbar"],[1,"table","table-striped"],[1,"col-md-1"],[2,"height","100%","width","100%"],[1,"nav","flex-column",2,"margin-top","20%"],["title","Menu",1,"nav-item",2,"width","70%"],[1,"nav-link",3,"click"],["src","../../assets/images/menu-racor.png","width","70%","height","100%",2,"margin-left","20%"],["title","Utilisateur",1,"nav-item",2,"width","50%","text-align","center","margin-top","10%","margin-left","12%"],["routerLink","/vente",1,"nav-link"],["src","./../../assets/images/sess-save.png","width","100%","height","100%"],[1,"nav-item",2,"width","70%","text-align","center","margin-top","1%"],["src","./../../assets/images/caisse.png","width","100%","height","100%"],[1,"nav-item",2,"width","50%","margin-top","10%","margin-left","15%"],["title","modifier ticket",1,"nav-link",3,"click"],["src","./../../assets/images/edit_ticket.png","width","100%","height","100%"],["class","nav-item","title","Valider","style","width: 50%;margin-top: 30%;margin-left:15% ;",4,"ngIf"],["class","nav-item","title","r\xe9glement","style","width: 70%;margin-top: 30%; margin-left:10%",3,"click",4,"ngIf"],["class","nav-item","title","ticket","style","width: 70%;margin-top: 30%; margin-left:10% ",4,"ngIf"],["class","nav-item","title","Facture","style","width: 70%;margin-top: 30%; margin-left:10%",4,"ngIf"],[1,"nav-item"],["role","tab","class","nav-link active ",4,"ngIf"],["role","tab","class","nav-link ",3,"click",4,"ngIf"],["role","tab",1,"nav-link","active"],["role","tab",1,"nav-link",3,"click"],[1,"col-md-2","main-card","mb-2","card",2,"margin-left","1%","margin-top","1%"],["width","100%",2,"text-align","center","margin-top","6%",3,"click"],[2,"margin-top","10%","text-align","left"],["width","50px","height","50px",3,"src"],[2,"text-align","right"],[3,"value"],["type","number",2,"width","30px",3,"matKeyboard","value","placeholder","keyup"],["title","Supprimer",1,"pe-7s-trash",2,"color","red",3,"click"],["title","Valider",1,"nav-item",2,"width","50%","margin-top","30%","margin-left","15%"],["src","./../../assets/images/affecter.jpg","width","100%","height","100%"],["title","r\xe9glement",1,"nav-item",2,"width","70%","margin-top","30%","margin-left","10%",3,"click"],["src","./../../assets/images/argent.jpg","width","100%","height","100%"],["title","ticket",1,"nav-item",2,"width","70%","margin-top","30%","margin-left","10%"],["src","./../../assets/images/ticket.png","width","100%","height","100%"],["title","Facture",1,"nav-item",2,"width","70%","margin-top","30%","margin-left","10%"],["src","./../../assets/images/logiciel-facturation.jpg","width","100%","height","100%"]],template:function(t,e){1&t&&(h.Tb(0,"div",0),h.Tb(1,"div",1),h.Tb(2,"div",2),h.Tb(3,"div",3),h.Tb(4,"ul",4),h.Ac(5,T,3,2,"li",5),h.Sb(),h.Sb(),h.Sb(),h.Tb(6,"div",6),h.Ac(7,C,8,3,"ng-container",7),h.Sb(),h.Tb(8,"mat-paginator",8),h.ac("page",function(t){return e.getData(t)}),h.Sb(),h.Sb(),h.Tb(9,"div",9),h.Tb(10,"div",3),h.Tb(11,"div",0),h.Tb(12,"section",10),h.Tb(13,"mat-form-field",11),h.Tb(14,"mat-label"),h.Cc(15," Cat\xe9gorie "),h.Sb(),h.Tb(16,"mat-select",12),h.ac("selectionChange",function(t){return e.choix_categorie(t)}),h.Ob(17,"mat-option",13),h.Ac(18,S,2,2,"mat-option",14),h.Sb(),h.Sb(),h.Tb(19,"mat-form-field",15),h.Tb(20,"mat-label"),h.Cc(21,"Nom"),h.Sb(),h.Tb(22,"input",16),h.ac("keyup",function(){return e.filtre()}),h.Sb(),h.Tb(23,"mat-error"),h.Cc(24,"Nom"),h.Sb(),h.Sb(),h.Tb(25,"mat-form-field",17),h.Tb(26,"mat-label"),h.Cc(27,"Code a barre"),h.Sb(),h.Tb(28,"input",18),h.ac("ngModelChange",function(t){return e.form.code=t})("keypress",function(t){return e.ajouter_article_code_a_barre(t)}),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(29,"div",19),h.Tb(30,"h3"),h.Cc(31),h.Sb(),h.Tb(32,"h3",20),h.Cc(33),h.Sb(),h.Tb(34,"div",21),h.Tb(35,"div",22),h.Tb(36,"div",23),h.Tb(37,"table",24),h.Tb(38,"thead"),h.Tb(39,"tr"),h.Tb(40,"th"),h.Cc(41,"Qte"),h.Sb(),h.Tb(42,"th"),h.Cc(43,"Nom"),h.Sb(),h.Tb(44,"th"),h.Cc(45,"Prix_U"),h.Sb(),h.Tb(46,"th"),h.Cc(47,"Total"),h.Sb(),h.Sb(),h.Sb(),h.Tb(48,"tbody"),h.Ac(49,w,11,6,"tr",7),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(50,"div",25),h.Tb(51,"nav",26),h.Tb(52,"ul",27),h.Tb(53,"li",28),h.Tb(54,"a",29),h.ac("click",function(){return e.mode()}),h.Ob(55,"img",30),h.Sb(),h.Sb(),h.Tb(56,"li",31),h.Tb(57,"a",32),h.Ob(58,"img",33),h.Sb(),h.Tb(59,"h3"),h.Cc(60),h.Sb(),h.Sb(),h.Tb(61,"li",34),h.Tb(62,"a",29),h.ac("click",function(){return e.open_cash_drawer()}),h.Ob(63,"img",35),h.Sb(),h.Tb(64,"h3"),h.Cc(65),h.Sb(),h.Sb(),h.Tb(66,"li",36),h.Tb(67,"a",37),h.ac("click",function(){return e.modifier_ticket()}),h.Ob(68,"img",38),h.Sb(),h.Sb(),h.Ac(69,y,3,0,"li",39),h.Ac(70,N,3,0,"li",40),h.Ac(71,k,3,0,"li",41),h.Ac(72,F,3,0,"li",42),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&t&&(h.Cb(5),h.kc("ngForOf",e.liste_categorie),h.Cb(2),h.kc("ngForOf",e.data),h.Cb(1),h.kc("length",e.data2.length)("pageSize",e.size)("pageIndex",e.page)("pageSizeOptions",h.nc(20,M)),h.Cb(4),h.kc("formGroup",e.form),h.Cb(6),h.kc("ngForOf",e.liste_categorie),h.Cb(4),h.kc("matKeyboard","de-CH"),h.Cb(6),h.kc("ngModel",e.form.code)("matKeyboard","de-CH"),h.Cb(3),h.Ec("Client : ",e.clt,""),h.Cb(2),h.Ec("Total TTC : ",e.total," DT"),h.Cb(16),h.kc("ngForOf",e.table),h.Cb(11),h.Dc(e.user.nom),h.Cb(5),h.Dc(e.session[0].caisse.nom),h.Cb(4),h.kc("ngIf",e.btn_valide),h.Cb(1),h.kc("ngIf",e.valide),h.Cb(1),h.kc("ngIf",e.payee),h.Cb(1),h.kc("ngIf",e.payee))},directives:[a.k,r.a,s.m,s.g,u.c,u.f,p.a,s.l,s.e,g.j,v.b,s.b,f.a,u.b,n.d,a.l],styles:["a[_ngcontent-%COMP%]{border:none;padding:0;text-decoration:none;border-radius:10%}img2[_ngcontent-%COMP%]{width:6vw;padding-top:-5%;border-radius:5%;box-shadow:2px 2px 2px #ffc312}.menu[_ngcontent-%COMP%]{position:relative;text-align:center;width:100%;top:20%;left:35%}.inline[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:0 2vw}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:hover{text-decoration:none;color:#52595d}.card[_ngcontent-%COMP%]{display:inline-block}.my-custom-scrollbar[_ngcontent-%COMP%]{position:relative;overflow:auto}.table-wrapper-scroll-y[_ngcontent-%COMP%]{display:block}@media print{.doNotPrint[_ngcontent-%COMP%]{display:none!important}}"]}),t})(),I=(()=>{class t{constructor(t,e,i,a){this.datePipe=t,this.fb=e,this.dialogRef=i,this.data=a,this.obj={},this.form=s.f,this.rest=0,this.retour=0,this.s=0,this.table=a.table,this.recu=a.recu=this.total,this.rendu=a.rendu=0,this.total=Number(a.total).toFixed(3),this.obj={},this.obj.mode="especes",this.obj.montant=this.total,this.obj.info="",this.table.length<1?this.table.push(this.obj):this.calcule()}savemode(t,e){this.table[t].mode=e.target.value}saveinfo(t,e){this.table[t].info=e.target.value}savenmontant(t,e){this.table[t].montant=e.target.value,this.calcule()}calcule(){let t=0;this.rest=0;for(let e=0;e<this.table.length;e++)t+=Number(this.table[e].montant);this.rest=(Number(this.total)-Number(t)).toFixed(3),this.retour=(Number(t)-Number(this.total)).toFixed(3),this.retour<0&&(this.retour=0),this.rest<0&&(this.rest=0),this.rendu=this.retour,this.recu=t}supp(t){this.table.splice(t,1)}add(){this.obj={},this.obj.mode="especes",this.obj.montant="0",this.obj.info="",this.table.push(this.obj)}valide(){this.dialogRef.close(),console.log(this.recu)}fermerDialogue(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(a.e),h.Nb(s.c),h.Nb(c.f),h.Nb(c.a))},t.\u0275cmp=h.Hb({type:t,selectors:[["reglement"]],decls:30,vars:4,consts:[["mat-dialog-actions",""],["mat-button","",1,"btn","btn-default",2,"margin-left","80%",3,"click"],["mat-button","",1,"btn","btn-primary",2,"margin-left","5%",3,"click"],[1,"container"],["mat-dialog-content",""],["mat-dialog-title","",1,"col-xs-8","text-center"],["mat-dialog-title","",2,"color","red","text-align","left"],["mat-dialog-title","",2,"color","red","text-align","right"],[1,"fas","fa-plus",3,"click"],[1,"table","table-striped"],[2,"width","20%"],[2,"width","60%"],[4,"ngFor","ngForOf"],[3,"change"],["value","especes"],["value","ticket"],["value","Cheque"],["type","number","placeholder"," ",3,"value","keyup"],["type","text","placeholder"," ","width","100%",3,"value","keyup"],[1,"fas","fa-trash-alt",3,"click"]],template:function(t,e){1&t&&(h.Tb(0,"div",0),h.Tb(1,"button",1),h.ac("click",function(){return e.fermerDialogue()}),h.Cc(2,"Fermer"),h.Sb(),h.Tb(3,"button",2),h.ac("click",function(){return e.valide()}),h.Cc(4,"Valider"),h.Sb(),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"div",4),h.Tb(7,"h1",5),h.Cc(8,"R\xe9glement"),h.Sb(),h.Tb(9,"h2",6),h.Cc(10),h.Sb(),h.Tb(11,"h3",7),h.Cc(12),h.Sb(),h.Tb(13,"h3",7),h.Cc(14),h.Sb(),h.Cc(15," \xa0\n\xa0\n"),h.Tb(16,"div",3),h.Tb(17,"div",4),h.Tb(18,"i",8),h.ac("click",function(){return e.add()}),h.Sb(),h.Tb(19,"table",9),h.Tb(20,"thead"),h.Tb(21,"tr"),h.Tb(22,"th",10),h.Cc(23,"Mode de paiement"),h.Sb(),h.Tb(24,"th",10),h.Cc(25,"Montant"),h.Sb(),h.Tb(26,"th",11),h.Cc(27,"Info"),h.Sb(),h.Sb(),h.Sb(),h.Ob(28,"tbody"),h.Ac(29,D,16,2,"tbody",12),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&t&&(h.Cb(10),h.Ec("Montant ",e.total," DT"),h.Cb(2),h.Ec("Reste ",e.rest," DT"),h.Cb(2),h.Ec("Retour ",e.retour," DT"),h.Cb(15),h.kc("ngForOf",e.table))},directives:[c.c,c.d,c.g,a.k,s.p,s.u],encapsulation:2}),t})();const L=[{path:"",component:j}];let H=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},imports:[[n.e.forChild(L)],n.e]}),t})();var O=i("Wp6s"),B=i("+0xr"),A=i("Dh3D"),q=i("bv9b");let z=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},imports:[[a.c,H,u.e,v.c,s.r,v.c,s.r,p.b,u.e,O.a,s.r,u.e,r.b,B.l,A.c,q.b,s.h,u.e,f.b,c.e]]}),t})()}}]);