(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{eBF6:function(t,e,i){"use strict";i.r(e),i.d(e,"FactureModule",function(){return H});var a=i("SVse"),l=i("iInd"),o=i("mrSG"),s=i("s7LF"),n=i("M9IT"),r=i("Dh3D"),c=i("+0xr"),h=i("8Y7J"),u=i("bAEo"),b=i("kmnG"),m=i("qFsG"),d=i("iadO");function p(t,e){1&t&&(h.Tb(0,"mat-error"),h.Cc(1," Date "),h.Sb())}function f(t,e){1&t&&(h.Tb(0,"mat-header-cell",26),h.Cc(1," id "),h.Sb())}function v(t,e){if(1&t&&(h.Tb(0,"mat-cell",27),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.Cb(1),h.Ec(" ",t.id,"")}}function g(t,e){1&t&&(h.Tb(0,"mat-header-cell",26),h.Cc(1," Client "),h.Sb())}function x(t,e){if(1&t&&(h.Tb(0,"mat-cell"),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.Cb(1),h.Ec(" ",t.client," ")}}function _(t,e){1&t&&(h.Tb(0,"mat-header-cell",26),h.Cc(1," Date "),h.Sb())}function S(t,e){if(1&t&&(h.Tb(0,"mat-cell",28),h.Cc(1),h.fc(2,"date"),h.Sb()),2&t){const t=e.$implicit;h.Cb(1),h.Ec(" ",h.hc(2,1,t.date,"dd/MM/yyyy - HH:mm")," ")}}function C(t,e){1&t&&(h.Tb(0,"mat-header-cell",26),h.Cc(1," Total "),h.Sb())}function y(t,e){if(1&t&&(h.Tb(0,"mat-cell",28),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.Cb(1),h.Ec(" ",t.prix," ")}}function P(t,e){1&t&&h.Ob(0,"mat-header-cell")}function w(t,e){if(1&t){const t=h.Ub();h.Tb(0,"mat-cell",29),h.Tb(1,"i",30),h.ac("click",function(){h.sc(t);const i=e.$implicit;return h.ec().imprimer_pdf(i.id)}),h.Sb(),h.Sb()}}function T(t,e){1&t&&h.Ob(0,"mat-header-row")}function k(t,e){1&t&&h.Ob(0,"mat-row")}const M=function(){return[8,50,100]},D=i("5JmO"),j=i("TruH");D.vfs=j.pdfMake.vfs;const A=[{path:"",component:(()=>{class t{constructor(t,e,i){this.service=t,this.datePipe=e,this.router=i,this.displayedColumns=["id","utilisateur","etat","total","sup"],this.etat="",this.dataSource=new c.k,this.paginator=n.a,this.sort=r.a,this.form=new s.f({id:new s.d(""),utilisateur:new s.d(""),client:new s.d(""),date:new s.d("")}),this.obj={},this.liste_ticket=[],this.table=[],this.table_reglement=[],this.liste_tva=[],this.liste_tva1=[],this.obj_tva={},this.obj5={},this.factures(),this.get_utilisateur()}factures(){this.service.factures().subscribe(t=>{for(let e=0;e<t.length;e++)t[e].prix=Number(Number(t[e].prix)+.6).toFixed(3);this.dataSource.data=t,this.liste_produit=t,this.liste_produit=this.liste_produit.sort((t,e)=>t.id>e.id?-1:1),this.dataSource.data=t,this.liste_produit.paginator=this.paginator})}choix(t){this.user=t.value,this.filtre()}get_utilisateur(){this.service.utilisateurs().subscribe(t=>{this.liste_Utilisateur=t})}ngOnInit(){}filtre(){var t,e,i,a,l,o;null==this.user&&(this.user=""),this.filtre_date=null==(null===(t=this.form.get("date"))||void 0===t?void 0:t.value)||null==(null===(e=this.form.get("date"))||void 0===e?void 0:e.value)||""==(null===(i=this.form.get("date"))||void 0===i?void 0:i.value)?"":this.datePipe.transform(null===(a=this.form.get("date"))||void 0===a?void 0:a.value,"yyyy-MM-dd"),this.service.filtre_facture("date",this.filtre_date,"Client",null===(l=this.form.get("client"))||void 0===l?void 0:l.value,"id",null===(o=this.form.get("id"))||void 0===o?void 0:o.value).subscribe(t=>{this.dataSource.data=t,this.liste_produit=t,this.liste_produit=this.liste_produit.sort((t,e)=>t.id>e.id?-1:1),this.dataSource.data=t,this.liste_produit.paginator=this.paginator})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}delai(t){return new Promise(e=>setTimeout(e,t))}imprimer_pdf(t){this.service.facture(t).subscribe(e=>{this.liste_ticket=[],this.total=e.prix,"system"==e.client?this.service.groupe_facture_ticket(t).subscribe(e=>{this.generatePDF_system(e,t)}):this.ticket(e.liste[0],e.client,e.id_Fiscale,t)})}ticket(t,e,a,l){return Object(o.a)(this,void 0,void 0,function*(){this.table=[],this.total=0,this.table_reglement=[],this.service.Detail_vente(t).subscribe(t=>{const e=new FileReader;e.onloadend=()=>{let t;if(this.Detail=e.result,(0,i("CDzl").parseString)(atob(this.Detail.substr(28)),function(e,i){t=i.Vente}),this.xmldata=t,this.total=0,null!=this.xmldata.Produits[0].Produit)for(let e=0;e<this.xmldata.Produits[0].Produit.length;e++)this.service.produit(this.xmldata.Produits[0].Produit[e].Id.toString()).subscribe(t=>{this.objxml=t,this.objxml.qte_v=this.xmldata.Produits[0].Produit[e].Qte.toString(),this.objxml.prix_vente=this.xmldata.Produits[0].Produit[e].prix_u.toString(),this.objxml.prix=Number(this.objxml.prix_vente)*Number(this.objxml.qte_v),this.service.unite(this.xmldata.Produits[0].Produit[e].unite.toString()).subscribe(t=>{this.objxml.unite=t}),this.table.push(this.objxml),this.total=Number(Number(this.total)+Number(this.objxml.prix)).toFixed(3)});if(null!=this.xmldata.Reglements[0].Reglement)for(let e=0;e<this.xmldata.Reglements[0].Reglement.length;e++)this.objxml={},this.objxml.mode=this.xmldata.Reglements[0].Reglement[e].Type.toString(),this.objxml.montant=this.xmldata.Reglements[0].Reglement[e].Montant.toString(),this.table_reglement.push(this.objxml);if(null!=this.xmldata.Tvas[0].TVA)for(let e=0;e<this.xmldata.Tvas[0].TVA.length;e++)this.objxml={},this.objxml.tva=this.xmldata.Tvas[0].TVA[e].Taxe.toString(),this.objxml.montant=this.xmldata.Tvas[0].TVA[e].Montant.toString(),this.objxml.val=this.xmldata.Tvas[0].TVA[e].Valeur.toString(),this.liste_tva.push(this.objxml)},e.readAsDataURL(t)}),yield this.delai(500),this.generatePDF(e,a,t,l)})}generatePDF(t,e,i,a){var l=[],o=[];(s=new Array).push("Id"),s.push("Nom"),s.push("Qte"),s.push("Prix HT"),s.push("%TVA"),s.push("Prix TTC"),s.push("Total TTC"),l.push(s);for(let c=0;c<this.table.length;c++){(s=new Array).push(this.table[c].id),s.push(this.table[c].nom),s.push(this.table[c].qte_v);let t=this.table[c].prix_vente/(this.table[c].tva/100+1);t=Math.round(1e3*t)/1e3,s.push(Number(t).toFixed(3)),s.push(this.table[c].tva),s.push(this.table[c].prix_vente),s.push(this.table[c].prix),l.push(s)}(s=new Array).push(""),s.push("timbre"),s.push(""),s.push(""),s.push(""),s.push(""),s.push("0.600"),l.push(s),(s=new Array).push("%Tva"),s.push("Montant"),s.push("Valeur"),o.push(s);for(let c=0;c<this.liste_tva.length;c++){var s;(s=new Array).push(this.liste_tva[c].tva),s.push(Number(this.liste_tva[c].montant).toFixed(3)),s.push(Number(this.liste_tva[c].val).toFixed(3)),o.push(s)}var n="";for(let c=0;c<this.table_reglement.length;c++)n=n+this.table_reglement[c].mode+" : "+this.table_reglement[c].montant+"\n";var r={defaultStyle:{},pageMargins:[40,100,40,180],info:{title:"Vente"},footer:function(t,e){return{margin:35,columns:[{fontSize:9,text:[{text:t.toString()+"/"+e}],relativePosition:{x:250,y:130}}]}},header:[{text:"Facture",fontSize:18,color:"black",bold:!0,relativePosition:{x:250,y:20}},{text:"Total : "+Number(this.total+.6).toFixed(3)+" DT    ",fontSize:10,color:"black",relativePosition:{x:400,y:60}},{text:"Client : "+t,fontSize:10,color:"black",relativePosition:{x:400,y:80}},,{text:"N\xb0 Facture : "+a,fontSize:10,color:"black",bold:!0,relativePosition:{x:50,y:40}},,{text:"N\xb0 ticket : "+i,fontSize:10,color:"black",relativePosition:{x:400,y:40}},{text:"Identifiant : "+e,fontSize:10,color:"black",relativePosition:{x:400,y:100}},{text:""+this.datePipe.transform(new Date,"dd/MM/yyyy"),fontSize:6,color:"black",bold:!0,relativePosition:{x:520,y:10}}],content:[{table:{widths:[50,150,25,50,27,60,60],body:l},fontSize:10,margin:[10,40,10,50]},{text:"Assiette TVA",fontSize:12,color:"black"},{table:{widths:[40,70,70],body:o},fontSize:10,margin:[10,20,10,50]},{text:"R\xe9glements",fontSize:12,color:"black"},{text:n,fontSize:8,color:"black"}]};D.createPdf(r).open({defaultFileName:"vente"+new Date+".pdf"})}generatePDF_system(t,e){var i=[],a=[],l=new Array;this.liste_tva1=[],l.push("Id Ticket"),l.push("Total"),i.push(l);for(let s=0;s<t.length;s++)(l=new Array).push(t[s].id),l.push(t[s].totale),i.push(l);(l=new Array).push("timbre"),l.push("0.600"),i.push(l),(l=new Array).push("%Tva"),l.push("Montant"),l.push("Valeur"),a.push(l);for(let s=0;s<t.length;s++)for(let e=0;e<t[s].liste.length;e++)this.obj5={},this.obj5.tva=t[s].liste[e].tva,this.obj5.montant=Number(t[s].liste[e].montant).toFixed(3),this.obj5.valeur=Number(t[s].liste[e].valeur).toFixed(3),this.liste_tva1.push(this.obj5);console.log(this.liste_tva1),this.liste_tva=[];for(let s=0;s<this.liste_tva1.length;s++){this.obj_tva={},this.obj_tva.tva=this.liste_tva1[s].tva,this.obj_tva.val=this.liste_tva1[s].valeur,this.obj_tva.montant=this.liste_tva1[s].montant;let t=!1;if(0==this.liste_tva.length)this.liste_tva.push(this.obj_tva);else{for(let e=0;e<this.liste_tva.length;e++)this.obj_tva.tva==this.liste_tva[e].tva&&(this.liste_tva[e].val=Number(Number(this.liste_tva[e].val)+Number(this.obj_tva.val)).toFixed(3),this.liste_tva[e].montant=Number(Number(this.liste_tva[e].montant)+Number(this.obj_tva.montant)).toFixed(3),t=!0);0==t&&this.liste_tva.push(this.obj_tva)}}console.log(this.liste_tva);for(let s=0;s<this.liste_tva.length;s++)(l=new Array).push(this.liste_tva[s].tva),l.push(this.liste_tva[s].montant),l.push(this.liste_tva[s].val),a.push(l);console.log(a);var o={defaultStyle:{},pageMargins:[40,100,40,180],info:{title:"Vente"},footer:function(t,e){return{margin:35,columns:[{fontSize:9,text:[{text:t.toString()+"/"+e}],relativePosition:{x:250,y:130}}]}},header:[{text:"Facture",fontSize:18,color:"black",bold:!0,relativePosition:{x:250,y:20}},{text:"Total : "+Number(this.total+.6).toFixed(3)+" DT    ",fontSize:10,color:"black",relativePosition:{x:400,y:60}},{text:"Client : Systeme",fontSize:10,color:"black",relativePosition:{x:400,y:80}},,{text:"N\xb0 Facture : "+e,fontSize:10,color:"black",bold:!0,relativePosition:{x:50,y:40}},{text:""+this.datePipe.transform(new Date,"dd/MM/yyyy"),fontSize:6,color:"black",bold:!0,relativePosition:{x:520,y:10}}],content:[{table:{widths:[50,80],body:i},fontSize:10,margin:[10,40,10,50]},{text:"Assiette TVA",fontSize:12,color:"black"},{table:{widths:[40,70,70],body:a},fontSize:10,margin:[10,20,10,50]}]};D.createPdf(o).open({defaultFileName:"vente"+new Date+".pdf"})}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(u.a),h.Nb(a.e),h.Nb(l.b))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-facture"]],viewQuery:function(t,e){if(1&t&&(h.Gc(n.a,!0),h.Gc(r.a,!0)),2&t){let t;h.oc(t=h.bc())&&(e.paginator=t.first),h.oc(t=h.bc())&&(e.sort=t.first)}},decls:40,vars:9,consts:[[2,"text-align","center","margin-top","3%","margin-bottom","6%","text-shadow","2px 4px 3px rgba(0,0,0,0.3)","font-size","300%"],[1,"position-relative","custom-control"],[3,"formGroup"],[2,"margin-left","2%","width","13%"],["matInput","","placeholder","id","formControlName","id",3,"keyup"],["matInput","","placeholder","client","formControlName","client",3,"keyup"],["matInput","","formControlName","date",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker2",""],[4,"ngIf"],[1,"mat-elevation-z8",2,"width","98%","height","500px","overflow-y","scroll"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-sort-header","",4,"matHeaderCellDef"],["data-label","id",4,"matCellDef"],["matColumnDef","utilisateur"],[4,"matCellDef"],["matColumnDef","etat"],["data-label","role",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","sup"],[4,"matHeaderCellDef"],["style","text-align: center;","data-label"," ",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-sort-header",""],["data-label","id"],["data-label","role"],["data-label"," ",2,"text-align","center"],["title","pdf",1,"pe-7s-print",2,"color","red","margin-left","15px",3,"click"]],template:function(t,e){if(1&t&&(h.Tb(0,"h1",0),h.Cc(1," Factures"),h.Sb(),h.Tb(2,"div",1),h.Tb(3,"section",2),h.Tb(4,"mat-form-field",3),h.Tb(5,"mat-label"),h.Cc(6," ID "),h.Sb(),h.Tb(7,"input",4),h.ac("keyup",function(){return e.filtre()}),h.Sb(),h.Sb(),h.Tb(8,"mat-form-field",3),h.Tb(9,"mat-label"),h.Cc(10," Client "),h.Sb(),h.Tb(11,"input",5),h.ac("keyup",function(){return e.filtre()}),h.Sb(),h.Sb(),h.Tb(12,"mat-form-field",3),h.Tb(13,"mat-label"),h.Cc(14," Date "),h.Sb(),h.Tb(15,"input",6),h.ac("dateChange",function(){return e.filtre()}),h.Sb(),h.Ob(16,"mat-datepicker-toggle",7),h.Ob(17,"mat-datepicker",null,8),h.Ac(19,p,2,0,"mat-error",9),h.Sb(),h.Sb(),h.Sb(),h.Tb(20,"div",10),h.Tb(21,"table",11),h.Rb(22,12),h.Ac(23,f,2,0,"mat-header-cell",13),h.Ac(24,v,2,1,"mat-cell",14),h.Qb(),h.Rb(25,15),h.Ac(26,g,2,0,"mat-header-cell",13),h.Ac(27,x,2,1,"mat-cell",16),h.Qb(),h.Rb(28,17),h.Ac(29,_,2,0,"mat-header-cell",13),h.Ac(30,S,3,4,"mat-cell",18),h.Qb(),h.Rb(31,19),h.Ac(32,C,2,0,"mat-header-cell",13),h.Ac(33,y,2,1,"mat-cell",18),h.Qb(),h.Rb(34,20),h.Ac(35,P,1,0,"mat-header-cell",21),h.Ac(36,w,2,0,"mat-cell",22),h.Qb(),h.Ac(37,T,1,0,"mat-header-row",23),h.Ac(38,k,1,0,"mat-row",24),h.Sb(),h.Ob(39,"mat-paginator",25),h.Sb()),2&t){const t=h.pc(18);h.Cb(3),h.kc("formGroup",e.form),h.Cb(12),h.kc("matDatepicker",t),h.Cb(1),h.kc("for",t),h.Cb(3),h.kc("ngIf",e.form.get("date").invalid),h.Cb(2),h.kc("dataSource",e.dataSource),h.Cb(16),h.kc("matHeaderRowDef",e.displayedColumns),h.Cb(1),h.kc("matRowDefColumns",e.displayedColumns),h.Cb(1),h.kc("pageSizeOptions",h.nc(8,M))}},directives:[s.m,s.g,b.c,b.f,m.b,s.b,s.l,s.e,d.b,d.d,b.g,d.a,a.l,c.j,r.a,c.c,c.e,c.b,c.g,c.i,n.a,b.b,c.d,r.b,c.a,c.f,c.h],pipes:[a.e],styles:["table[_ngcontent-%COMP%]{width:100%;overflow-x:scroll!important}.mat-column-id[_ngcontent-%COMP%]{width:100%;text-align:center}@media only screen and (max-width:768px){.mat-table[_ngcontent-%COMP%]{border:0;vertical-align:middle}.mat-table[_ngcontent-%COMP%]   caption[_ngcontent-%COMP%]{font-size:1em}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{border-bottom:5px solid #ddd;display:block;min-height:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;display:block;font-size:1em;text-align:right;font-weight:700;height:auto;margin-bottom:4%;padding-right:5%;padding-bottom:4%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:before{content:attr(data-label);float:left;text-transform:uppercase;font-weight:400;margin-left:5%;font-size:.85em}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:last-child{border-bottom:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:first-child{margin-top:4%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:last-of-type{padding-right:5%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:first-of-type{padding-left:0}.mat-table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{border:10px solid;clip:rect(0 0 0 0);height:1px;margin:-1px;padding:0;position:absolute;width:1px}.mat-header-row[_ngcontent-%COMP%]{min-height:0}}"]}),t})()}];let O=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},imports:[[l.e.forChild(A)],l.e]}),t})();var N=i("d3UM"),z=i("Wp6s"),F=i("bv9b"),R=i("uM5D"),V=i("0IaG"),I=i("FKr1");let H=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},imports:[[a.c,O,b.e,m.c,N.b,b.e,z.a,s.r,n.b,c.l,r.c,F.b,s.h,R.b,V.e,d.c,I.i]]}),t})()}}]);