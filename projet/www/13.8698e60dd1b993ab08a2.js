(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{VdIm:function(t,e,i){"use strict";i.r(e),i.d(e,"TicketsModule",function(){return L});var a=i("SVse"),n=i("iInd"),o=i("mrSG"),l=i("s7LF"),r=i("M9IT"),s=i("Dh3D"),c=i("+0xr"),m=i("PSD3"),b=i.n(m),d=i("8Y7J"),u=i("bAEo"),h=i("kmnG"),f=i("qFsG"),p=i("d3UM"),g=i("iadO"),x=i("FKr1");function v(t,e){if(1&t&&(d.Tb(0,"mat-option",35),d.Cc(1),d.Sb()),2&t){const t=e.$implicit;d.kc("value",t.id),d.Cb(1),d.Ec(" ",t.nom,"")}}function C(t,e){1&t&&(d.Tb(0,"mat-error"),d.Cc(1," Date "),d.Sb())}function S(t,e){1&t&&(d.Tb(0,"mat-header-cell",36),d.Cc(1," id "),d.Sb())}function _(t,e){if(1&t&&(d.Tb(0,"mat-cell",37),d.Cc(1),d.Sb()),2&t){const t=e.$implicit;d.Cb(1),d.Ec(" ",t.id,"")}}function T(t,e){1&t&&(d.Tb(0,"mat-header-cell",36),d.Cc(1," Utilisateur "),d.Sb())}function k(t,e){if(1&t&&(d.Tb(0,"mat-cell"),d.Cc(1),d.Sb()),2&t){const t=e.$implicit;d.Cb(1),d.Ec(" ",t.id_Utilisateur.nom," ")}}function w(t,e){1&t&&(d.Tb(0,"mat-header-cell",36),d.Cc(1," etat "),d.Sb())}function y(t,e){if(1&t&&(d.Tb(0,"mat-cell",38),d.Cc(1),d.Sb()),2&t){const t=e.$implicit;d.Cb(1),d.Ec(" ",t.test," ")}}function P(t,e){1&t&&(d.Tb(0,"mat-header-cell",36),d.Cc(1," Date "),d.Sb())}function D(t,e){if(1&t&&(d.Tb(0,"mat-cell",38),d.Cc(1),d.fc(2,"date"),d.Sb()),2&t){const t=e.$implicit;d.Cb(1),d.Ec(" ",d.hc(2,1,t.date,"dd/MM/yyyy - HH:mm")," ")}}function M(t,e){1&t&&(d.Tb(0,"mat-header-cell",36),d.Cc(1," Total "),d.Sb())}function O(t,e){if(1&t&&(d.Tb(0,"mat-cell",38),d.Cc(1),d.Sb()),2&t){const t=e.$implicit;d.Cb(1),d.Ec(" ",t.total," ")}}function A(t,e){1&t&&d.Ob(0,"mat-header-cell")}function j(t,e){if(1&t){const t=d.Ub();d.Tb(0,"img",42),d.ac("click",function(){d.sc(t);const e=d.ec().$implicit;return d.ec().abondonner(e.id)}),d.Sb()}}function R(t,e){if(1&t){const t=d.Ub();d.Tb(0,"mat-cell",39),d.Tb(1,"img",40),d.ac("click",function(){d.sc(t);const i=e.$implicit;return d.ec().ticket(i.id)}),d.Sb(),d.Ac(2,j,1,0,"img",41),d.Sb()}if(2&t){const t=e.$implicit;d.Cb(2),d.kc("ngIf","ok"==t.test)}}function N(t,e){1&t&&d.Ob(0,"mat-header-row")}function F(t,e){1&t&&d.Ob(0,"mat-row")}const z=function(){return[8,16,32]},I=i("5JmO"),V=i("TruH");I.vfs=V.pdfMake.vfs;const E=[{path:"",component:(()=>{class t{constructor(t,e,i){this.service=t,this.datePipe=e,this.router=i,this.displayedColumns=["id","utilisateur","etat","total","date","sup"],this.etat="",this.type="",this.dataSource=new c.k,this.paginator=r.a,this.sort=s.a,this.form=new l.f({id:new l.d(""),utilisateur:new l.d(""),date:new l.d(""),type:new l.d("")}),this.objxml={},this.total=0,this.table=[],this.table_reglement=[],this.liste_tva=[],this.filtre(),this.get_utilisateur(),this.ticket_non_facture=0,this.service.get_somme_ticket_non_facture().subscribe(t=>{this.ticket_non_facture=Number(t).toFixed(3)})}choix(t){this.user=t.value,this.filtre()}choix_type(t){this.type=t.value,this.filtre()}choix_etat(t){this.etat=t.value,this.filtre()}get_utilisateur(){this.service.utilisateurs().subscribe(t=>{this.liste_Utilisateur=t})}ngOnInit(){}delai(t){return new Promise(e=>setTimeout(e,t))}ticket(t){return Object(o.a)(this,void 0,void 0,function*(){this.table=[],this.total=0,this.table_reglement=[],this.service.vente(t).subscribe(t=>{this.client=t.client}),this.id_vente=t,this.service.Detail_vente(t).subscribe(t=>{const e=new FileReader;e.onloadend=()=>{let t;if(this.Detail=e.result,(0,i("CDzl").parseString)(atob(this.Detail.substr(28)),function(e,i){t=i.Vente}),this.xmldata=t,this.total=0,null!=this.xmldata.Produits[0].Produit)for(let e=0;e<this.xmldata.Produits[0].Produit.length;e++)this.service.produit(this.xmldata.Produits[0].Produit[e].Id.toString()).subscribe(t=>{this.objxml=t,this.objxml.qte_v=this.xmldata.Produits[0].Produit[e].Qte.toString(),this.objxml.prix_vente=this.xmldata.Produits[0].Produit[e].prix_u.toString(),this.objxml.prix=Number(this.objxml.prix_vente)*Number(this.objxml.qte_v),this.service.unite(this.xmldata.Produits[0].Produit[e].unite.toString()).subscribe(t=>{this.objxml.unite=t}),this.table.push(this.objxml),this.total=Number(Number(this.total)+Number(this.objxml.prix)).toFixed(3)});if(null!=this.xmldata.Reglements[0].Reglement)for(let e=0;e<this.xmldata.Reglements[0].Reglement.length;e++)this.objxml={},this.objxml.mode=this.xmldata.Reglements[0].Reglement[e].Type.toString(),this.objxml.montant=this.xmldata.Reglements[0].Reglement[e].Montant.toString(),this.table_reglement.push(this.objxml);if(null!=this.xmldata.Tvas[0].TVA)for(let e=0;e<this.xmldata.Tvas[0].TVA.length;e++)this.objxml={},this.objxml.tva=this.xmldata.Tvas[0].TVA[e].Taxe.toString(),this.objxml.montant=this.xmldata.Tvas[0].TVA[e].Montant.toString(),this.objxml.val=this.xmldata.Tvas[0].TVA[e].Valeur.toString(),this.liste_tva.push(this.objxml)},e.readAsDataURL(t)}),yield this.delai(500),this.generatePDF(this.client)})}generatePDF(t){var e=[],i=[];(a=new Array).push("Id"),a.push("Nom"),a.push("Qte"),a.push("Prix HT"),a.push("%TVA"),a.push("Prix TTC"),a.push("Total TTC"),e.push(a);for(let l=0;l<this.table.length;l++){(a=new Array).push(this.table[l].id),a.push(this.table[l].nom),a.push(this.table[l].qte_v);let t=this.table[l].prix_vente/(this.table[l].tva/100+1);t=Math.round(1e3*t)/1e3,a.push(Number(t).toFixed(3)),a.push(this.table[l].tva),a.push(this.table[l].prix_vente),a.push(this.table[l].prix),e.push(a)}(a=new Array).push("%Tva"),a.push("Montant"),a.push("Valeur"),i.push(a);for(let l=0;l<this.liste_tva.length;l++){var a;(a=new Array).push(this.liste_tva[l].tva),a.push(Number(this.liste_tva[l].montant).toFixed(3)),a.push(Number(this.liste_tva[l].val).toFixed(3)),i.push(a)}var n="";for(let l=0;l<this.table_reglement.length;l++)n=n+this.table_reglement[l].mode+" : "+this.table_reglement[l].montant+"\n";var o={defaultStyle:{},pageMargins:[40,100,40,180],info:{title:"Vente"},footer:function(t,e){return{margin:35,columns:[{fontSize:9,text:[{text:t.toString()+"/"+e}],relativePosition:{x:250,y:130}}]}},header:[{text:"Ticket",fontSize:18,color:"black",bold:!0,relativePosition:{x:250,y:20}},{text:"Total : "+Number(this.total).toFixed(3)+" DT    ",fontSize:10,color:"black",relativePosition:{x:400,y:60}},{text:"Client : "+t,fontSize:10,color:"black",relativePosition:{x:400,y:80}},,{text:"N\xb0 Vente : "+this.id_vente,fontSize:10,color:"black",relativePosition:{x:400,y:40}},{text:""+this.datePipe.transform(new Date,"dd/MM/yyyy"),fontSize:6,color:"black",bold:!0,relativePosition:{x:520,y:10}}],content:[{table:{widths:[50,150,25,50,27,60,60],body:e},fontSize:10,margin:[10,0,10,50]},{text:"Assiette TVA",fontSize:12,color:"black"},{table:{widths:[40,70,70],body:i},fontSize:10,margin:[10,20,10,50]},{text:"R\xe9glements",fontSize:12,color:"black"},{text:n,fontSize:8,color:"black"}]};I.createPdf(o).open({defaultFileName:"vente"+new Date+".pdf"})}abondonner(t){this.service.abondonner(t).subscribe(t=>{this.filtre()})}filtre(){var t,e,i,a,n;null==this.user&&(this.user=""),this.filtre_date=null==(null===(t=this.form.get("date"))||void 0===t?void 0:t.value)||null==(null===(e=this.form.get("date"))||void 0===e?void 0:e.value)||""==(null===(i=this.form.get("date"))||void 0===i?void 0:i.value)?"":this.datePipe.transform(null===(a=this.form.get("date"))||void 0===a?void 0:a.value,"yyyy-MM-dd"),this.service.filtre_vente("date",this.filtre_date,"type",this.type,"id_utlisateur",this.user,"id",null===(n=this.form.get("id"))||void 0===n?void 0:n.value).subscribe(t=>{for(let e=0;e<t.length;e++)t[e].total=Number(t[e].total).toFixed(3);this.dataSource.data=t,this.liste_produit=t,this.liste_produit=this.liste_produit.sort((t,e)=>t.id>e.id?-1:1),this.dataSource.data=t,this.liste_produit.paginator=this.paginator})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}facturation(){b.a.fire({icon:"success",cancelButtonText:"ok"}),0==this.ticket_non_facture?b.a.fire({icon:"error",title:"",text:"  "}):(this.service.Facturation().subscribe(t=>{}),window.location.reload())}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(u.a),d.Nb(a.e),d.Nb(n.b))},t.\u0275cmp=d.Hb({type:t,selectors:[["app-tickets"]],viewQuery:function(t,e){if(1&t&&(d.Gc(r.a,!0),d.Gc(s.a,!0)),2&t){let t;d.oc(t=d.bc())&&(e.paginator=t.first),d.oc(t=d.bc())&&(e.sort=t.first)}},decls:57,vars:11,consts:[[2,"text-align","center","margin-top","3%","margin-bottom","6%","text-shadow","2px 4px 3px rgba(0,0,0,0.3)","font-size","300%"],[1,"position-relative","custom-control"],[3,"formGroup"],[2,"margin-left","2%","width","13%"],["matInput","","placeholder","id","formControlName","id",3,"keyup"],[2,"width","13%","margin-left","2%"],["formControlName","utilisateur","aria-placeholder"," ",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","date",3,"matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker2",""],[4,"ngIf"],["formControlName","type","aria-placeholder"," ",3,"selectionChange"],["value",""],["value","facture"],["value","ticket"],[2,"text-align","right","margin-right","10%"],["type","button",1,"btn","btn-warning",2,"margin-left","2%",3,"click"],[1,"mat-elevation-z8",2,"width","98%","height","500px","overflow-y","scroll"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-sort-header","",4,"matHeaderCellDef"],["data-label","id",4,"matCellDef"],["matColumnDef","utilisateur"],[4,"matCellDef"],["matColumnDef","etat"],["data-label","role",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","total"],["matColumnDef","sup"],[4,"matHeaderCellDef"],["style","text-align: center;","data-label"," ",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],[3,"value"],["mat-sort-header",""],["data-label","id"],["data-label","role"],["data-label"," ",2,"text-align","center"],["src","./../../../assets/images/ticket.png","width","30px",2,"margin-left","10%",3,"click"],["src","./../../../assets/images/abo.png","width","20px","style","margin-left: 10%;",3,"click",4,"ngIf"],["src","./../../../assets/images/abo.png","width","20px",2,"margin-left","10%",3,"click"]],template:function(t,e){if(1&t&&(d.Tb(0,"h1",0),d.Cc(1," Tickets"),d.Sb(),d.Tb(2,"div",1),d.Tb(3,"section",2),d.Tb(4,"mat-form-field",3),d.Tb(5,"mat-label"),d.Cc(6," ID "),d.Sb(),d.Tb(7,"input",4),d.ac("keyup",function(){return e.filtre()}),d.Sb(),d.Sb(),d.Tb(8,"mat-form-field",5),d.Tb(9,"mat-label"),d.Cc(10," Utilisateur "),d.Sb(),d.Tb(11,"mat-select",6),d.ac("selectionChange",function(t){return e.choix(t)}),d.Ac(12,v,2,2,"mat-option",7),d.Sb(),d.Sb(),d.Tb(13,"mat-form-field",3),d.Tb(14,"mat-label"),d.Cc(15," Date "),d.Sb(),d.Tb(16,"input",8),d.ac("dateChange",function(){return e.filtre()}),d.Sb(),d.Ob(17,"mat-datepicker-toggle",9),d.Ob(18,"mat-datepicker",null,10),d.Ac(20,C,2,0,"mat-error",11),d.Sb(),d.Tb(21,"mat-form-field",5),d.Tb(22,"mat-label"),d.Cc(23," Etat "),d.Sb(),d.Tb(24,"mat-select",12),d.ac("selectionChange",function(t){return e.choix_type(t)}),d.Ob(25,"mat-option",13),d.Tb(26,"mat-option",14),d.Cc(27," factur\xe9 "),d.Sb(),d.Tb(28,"mat-option",15),d.Cc(29," non factur\xe9 "),d.Sb(),d.Sb(),d.Sb(),d.Tb(30,"h3",16),d.Cc(31),d.Tb(32,"button",17),d.ac("click",function(){return e.facturation()}),d.Cc(33,"factur\xe9s"),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Tb(34,"div",18),d.Tb(35,"table",19),d.Rb(36,20),d.Ac(37,S,2,0,"mat-header-cell",21),d.Ac(38,_,2,1,"mat-cell",22),d.Qb(),d.Rb(39,23),d.Ac(40,T,2,0,"mat-header-cell",21),d.Ac(41,k,2,1,"mat-cell",24),d.Qb(),d.Rb(42,25),d.Ac(43,w,2,0,"mat-header-cell",21),d.Ac(44,y,2,1,"mat-cell",26),d.Qb(),d.Rb(45,27),d.Ac(46,P,2,0,"mat-header-cell",21),d.Ac(47,D,3,4,"mat-cell",26),d.Qb(),d.Rb(48,28),d.Ac(49,M,2,0,"mat-header-cell",21),d.Ac(50,O,2,1,"mat-cell",26),d.Qb(),d.Rb(51,29),d.Ac(52,A,1,0,"mat-header-cell",30),d.Ac(53,R,3,1,"mat-cell",31),d.Qb(),d.Ac(54,N,1,0,"mat-header-row",32),d.Ac(55,F,1,0,"mat-row",33),d.Sb(),d.Ob(56,"mat-paginator",34),d.Sb()),2&t){const t=d.pc(19);d.Cb(3),d.kc("formGroup",e.form),d.Cb(9),d.kc("ngForOf",e.liste_Utilisateur),d.Cb(4),d.kc("matDatepicker",t),d.Cb(1),d.kc("for",t),d.Cb(3),d.kc("ngIf",e.form.get("date").invalid),d.Cb(11),d.Ec("Somme des tickets non Facture : ",e.ticket_non_facture," DT "),d.Cb(4),d.kc("dataSource",e.dataSource),d.Cb(19),d.kc("matHeaderRowDef",e.displayedColumns),d.Cb(1),d.kc("matRowDefColumns",e.displayedColumns),d.Cb(1),d.kc("pageSizeOptions",d.nc(10,z))}},directives:[l.m,l.g,h.c,h.f,f.b,l.b,l.l,l.e,p.a,a.k,g.b,g.d,h.g,g.a,a.l,x.j,c.j,s.a,c.c,c.e,c.b,c.g,c.i,r.a,h.b,c.d,s.b,c.a,c.f,c.h],pipes:[a.e],styles:["table[_ngcontent-%COMP%]{width:100%;overflow-x:scroll!important}.mat-column-id[_ngcontent-%COMP%]{width:100%;text-align:center}@media only screen and (max-width:768px){.mat-table[_ngcontent-%COMP%]{border:0;vertical-align:middle}.mat-table[_ngcontent-%COMP%]   caption[_ngcontent-%COMP%]{font-size:1em}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{border-bottom:5px solid #ddd;display:block;min-height:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;display:block;font-size:1em;text-align:right;font-weight:700;height:auto;margin-bottom:4%;padding-right:5%;padding-bottom:4%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:before{content:attr(data-label);float:left;text-transform:uppercase;font-weight:400;margin-left:5%;font-size:.85em}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:last-child{border-bottom:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:first-child{margin-top:4%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:last-of-type{padding-right:5%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:first-of-type{padding-left:0}.mat-table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{border:10px solid;clip:rect(0 0 0 0);height:1px;margin:-1px;padding:0;position:absolute;width:1px}.mat-header-row[_ngcontent-%COMP%]{min-height:0}}"]}),t})()}];let H=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},imports:[[n.e.forChild(E)],n.e]}),t})();var Q=i("Wp6s"),U=i("bv9b"),$=i("uM5D"),G=i("0IaG");let L=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},imports:[[a.c,H,h.e,f.c,p.b,h.e,Q.a,l.r,r.b,c.l,s.c,U.b,l.h,$.b,G.e,g.c,x.i]]}),t})()}}]);